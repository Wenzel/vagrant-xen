---
- name: Install QEMU
  package:
    name: "{{ item }}"
  with_items:
    - qemu

- name: download Windows image
  get_url:
    url: 'https://www.dropbox.com/s/00f6t4xovjpuwv3/winxp.qcow2?dl=1'
    dest: /var/lib/libvirt/images/winxp.qcow2
    checksum: 'sha1:d460df4ef17cf10f10771b43c2ae2c297429e4bf'

- name: refresh libvirt pool
  command: virsh -c xen:/// pool-refresh default

- name: install libvirt-python module to manage VMs
  package:
    name: python-libvirt

- name: define VM in libvirt
  virt:
    name: winxp
    command: define
    xml: "{{ lookup('file', 'domain.xml') }}"
    uri: 'xen:///'
